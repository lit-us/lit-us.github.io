<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
    <title>科学计算器</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <script type="text/javascript">
    <!--
        function calculate(){
            try {
                // 兼容IE4的DOM访问方式
                var formula = document.forms[0].elements['formula'].value;
                
                // 空输入检测
                if(!formula || formula.replace(/^\s+|\s+$/g, '') === ""){
                    alert("请输入计算公式");
                    return false;
                }
                
                // 数学符号替换（ES3兼容）
                var expr = formula
                    .replace(/\^/g, ',')  // 将^转换为逗号
                    .replace(/(\d+),(\d+)/g, 'Math.pow($1,$2)') // 转换2^3为Math.pow(2,3)
                    .replace(/sqrt/g, 'Math.sqrt')
                    .replace(/sin/g, 'Math.sin')
                    .replace(/cos/g, 'Math.cos')
                    .replace(/tan/g, 'Math.tan')
                    .replace(/log\(/g, 'Math.log10(')
                    .replace(/ln\(/g, 'Math.log(')
                    .replace(/abs/g, 'Math.abs')
                    .replace(/pi/g, 'Math.PI')
                    .replace(/e\b/g, 'Math.E');

                // 执行计算并弹窗显示
                alert("计算结果: " + eval(expr));
            } 
            catch(err){
                alert("计算错误: " + err.message.split('\n')[0]); // 兼容早期错误信息格式
            }
            return false; // 阻止表单提交
        }
    //-->
    </script>
</head>
<body>
    <h2>科学计算器</h2>
    <form onsubmit="return calculate()" action="javascript:void(0)">
        <input type="text" name="formula" size="25" value="">
        <input type="submit" value="计算">
    </form>
</body>
</html>
